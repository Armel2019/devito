# spin me one more time
name: Jupyter Notebooks

on: push

jobs:
  tutorials:
    name: ${{ matrix.name }}
    runs-on: ubuntu-latest

    env:
      DEVITO_ARCH: "gcc-7"
      DEVITO_LANGUAGE: "openmp"
      DEVITO_BACKEND: "core"
      CC: "gcc-7"
      CXX: "g++-7"

    strategy:
      # Prevent all build to stop if a single one fails
      fail-fast: false
      matrix:
        name: [
          distributed00,
          distributed01,
          distributed02,
          distributed03,
          distributed04,
          distributed05
          ]

        include:
          - name: distributed00
            version: f66eda86c36e2f0b0496552c496736baf80c1c1e

          - name: distributed01
            version: 410126467f8dfb7fac3d978a82e456f4d40feb3a

          - name: distributed02
            version: 5eb3745067fdba2170b8f61882644dab7992d288

          - name: distributed03
            version: 0eacd789cac952a925a12898ae2fa5abe3a5e3d8

          - name: distributed04
            version: 08d334e2e18bd977752eeab87e2c09272a2ac829

          - name: distributed05
            version: ef168a471a7b6b4dc4b023196afc229cda109608

    steps:
    - name: Checkout devito
      uses: actions/checkout@v1

    - name: Set up Python 3.7
      uses: actions/setup-python@v1
      with:
        python-version: 3.7

    - name: Set distributed
      run: |
        cd ..
        git clone https://github.com/dask/distributed.git
        cd distributed
        git checkout ${{ matrix.version }}
        python setup.py install
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -e .
        pip install matplotlib
    - name: Seismic notebooks
      run: |
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
        py.test --nbval $SKIP examples/seismic/tutorials/
